<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Streaming Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            border: 1px solid #ccc;
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .test-result {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: #007bff;
            width: 0%;
            transition: width 0.1s ease;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Manual Streaming Functionality Test</h1>
    <p>ì´ í˜ì´ì§€ëŠ” ìŠ¤íŠ¸ë¦¬ë° ê¸°ëŠ¥ì„ ìˆ˜ë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ë„êµ¬ì…ë‹ˆë‹¤.</p>
    
    <div class="test-section">
        <h2>Test 1: ì§§ì€ ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë° (Requirement 2.1)</h2>
        <p>ì§§ì€ ì‘ë‹µì´ í•œ ê¸€ìì”© í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <button onclick="testShortResponse()">ì§§ì€ ì‘ë‹µ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div class="progress">
            <div id="progress1" class="progress-bar"></div>
        </div>
        <div id="result1" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: ê¸´ ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë° (Requirement 2.2)</h2>
        <p>ê¸´ ì‘ë‹µì´ ë¶€ë“œëŸ½ê²Œ í•œ ê¸€ìì”© í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <button onclick="testLongResponse()">ê¸´ ì‘ë‹µ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div class="progress">
            <div id="progress2" class="progress-bar"></div>
        </div>
        <div id="result2" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ í™•ì¸ (Requirement 2.3)</h2>
        <p>ìŠ¤íŠ¸ë¦¬ë°ì´ ì™„ë£Œë˜ê³  ì „ì²´ ì‘ë‹µì´ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <button onclick="testStreamingCompletion()">ì™„ë£Œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div class="progress">
            <div id="progress3" class="progress-bar"></div>
        </div>
        <div id="result3" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: íŠ¹ìˆ˜ ë¬¸ì ë° ë©€í‹°ë¼ì¸ ì‘ë‹µ</h2>
        <p>íŠ¹ìˆ˜ ë¬¸ìì™€ ì—¬ëŸ¬ ì¤„ì´ í¬í•¨ëœ ì‘ë‹µì˜ ìŠ¤íŠ¸ë¦¬ë°ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <button onclick="testSpecialCharacters()">íŠ¹ìˆ˜ ë¬¸ì í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div class="progress">
            <div id="progress4" class="progress-bar"></div>
        </div>
        <div id="result4" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 5: ì‘ë‹µ íŒŒì‹± í†µí•© í…ŒìŠ¤íŠ¸</h2>
        <p>ìˆ˜ì •ëœ ì‘ë‹µ íŒŒì‹± ë¡œì§ê³¼ ìŠ¤íŠ¸ë¦¬ë°ì˜ í†µí•©ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <button onclick="testResponseParsing()">íŒŒì‹± í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div class="progress">
            <div id="progress5" class="progress-bar"></div>
        </div>
        <div id="result5" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</h2>
        <button onclick="runAllTests()">ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div id="overall-result" class="test-result"></div>
    </div>

    <script>
        // ìŠ¤íŠ¸ë¦¬ë° ì‹œë®¬ë ˆì´ì…˜ í•¨ìˆ˜ (App.tsxì˜ ë¡œì§ì„ ê¸°ë°˜ìœ¼ë¡œ í•¨)
        async function simulateStreaming(responseText, onUpdate, progressElementId) {
            let currentText = "";
            const progressElement = document.getElementById(progressElementId);
            
            for (let i = 0; i < responseText.length; i++) {
                currentText += responseText[i];
                onUpdate(currentText);
                
                // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
                const progress = ((i + 1) / responseText.length) * 100;
                progressElement.style.width = progress + '%';
                
                // 20ms ë”œë ˆì´ (ì‹¤ì œ êµ¬í˜„ê³¼ ë™ì¼)
                await new Promise(resolve => setTimeout(resolve, 20));
            }
            
            return currentText;
        }

        // Test 1: ì§§ì€ ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë°
        async function testShortResponse() {
            const resultElement = document.getElementById('result1');
            const shortResponse = "ì•ˆë…•í•˜ì„¸ìš”!";
            const updates = [];
            
            resultElement.textContent = "í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...";
            resultElement.className = "test-result";
            
            try {
                const finalText = await simulateStreaming(
                    shortResponse,
                    (text) => {
                        updates.push(text);
                        resultElement.textContent = `í˜„ì¬ í‘œì‹œ: "${text}"`;
                    },
                    'progress1'
                );
                
                // ê²€ì¦
                const expectedUpdates = ["ì•ˆ", "ì•ˆë…•", "ì•ˆë…•í•˜", "ì•ˆë…•í•˜ì„¸", "ì•ˆë…•í•˜ì„¸ìš”", "ì•ˆë…•í•˜ì„¸ìš”!"];
                const passed = JSON.stringify(updates) === JSON.stringify(expectedUpdates);
                
                resultElement.className = `test-result ${passed ? 'success' : 'error'}`;
                resultElement.textContent = `
í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${passed ? 'âœ… í†µê³¼' : 'âŒ ì‹¤íŒ¨'}
ìµœì¢… í…ìŠ¤íŠ¸: "${finalText}"
ì—…ë°ì´íŠ¸ íšŸìˆ˜: ${updates.length}
ì˜ˆìƒ ì—…ë°ì´íŠ¸: ${expectedUpdates.length}
ì‹¤ì œ ì—…ë°ì´íŠ¸: [${updates.join('", "')}]
                `.trim();
            } catch (error) {
                resultElement.className = "test-result error";
                resultElement.textContent = `âŒ ì—ëŸ¬: ${error.message}`;
            }
        }

        // Test 2: ê¸´ ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë°
        async function testLongResponse() {
            const resultElement = document.getElementById('result2');
            const longResponse = "ì´ê²ƒì€ ìŠ¤íŠ¸ë¦¬ë° íš¨ê³¼ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ë§¤ìš° ê¸´ ì‘ë‹µì…ë‹ˆë‹¤. ê° ê¸€ìê°€ í•˜ë‚˜ì”© ë¶€ë“œëŸ½ê²Œ ë‚˜íƒ€ë‚˜ì•¼ í•˜ë©°, ì‚¬ìš©ìëŠ” í…ìŠ¤íŠ¸ê°€ ì ì§„ì ìœ¼ë¡œ í‘œì‹œë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì´ í…ŒìŠ¤íŠ¸ëŠ” ê¸´ ì‘ë‹µì—ì„œë„ ìŠ¤íŠ¸ë¦¬ë°ì´ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.";
            let updateCount = 0;
            
            resultElement.textContent = "ê¸´ ì‘ë‹µ í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...";
            resultElement.className = "test-result";
            
            try {
                const startTime = Date.now();
                const finalText = await simulateStreaming(
                    longResponse,
                    (text) => {
                        updateCount++;
                        resultElement.textContent = `ì§„í–‰ë¥ : ${updateCount}/${longResponse.length}\ní˜„ì¬: "${text.substring(0, 50)}${text.length > 50 ? '...' : ''}"`;
                    },
                    'progress2'
                );
                const endTime = Date.now();
                
                // ê²€ì¦
                const expectedDuration = longResponse.length * 20; // 20ms per character
                const actualDuration = endTime - startTime;
                const durationOk = Math.abs(actualDuration - expectedDuration) < 1000; // 1ì´ˆ ì˜¤ì°¨ í—ˆìš©
                
                const passed = updateCount === longResponse.length && finalText === longResponse && durationOk;
                
                resultElement.className = `test-result ${passed ? 'success' : 'error'}`;
                resultElement.textContent = `
í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${passed ? 'âœ… í†µê³¼' : 'âŒ ì‹¤íŒ¨'}
ìµœì¢… í…ìŠ¤íŠ¸ ê¸¸ì´: ${finalText.length} (ì˜ˆìƒ: ${longResponse.length})
ì—…ë°ì´íŠ¸ íšŸìˆ˜: ${updateCount} (ì˜ˆìƒ: ${longResponse.length})
ì†Œìš” ì‹œê°„: ${actualDuration}ms (ì˜ˆìƒ: ~${expectedDuration}ms)
í…ìŠ¤íŠ¸ ì¼ì¹˜: ${finalText === longResponse ? 'âœ…' : 'âŒ'}
                `.trim();
            } catch (error) {
                resultElement.className = "test-result error";
                resultElement.textContent = `âŒ ì—ëŸ¬: ${error.message}`;
            }
        }

        // Test 3: ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ í™•ì¸
        async function testStreamingCompletion() {
            const resultElement = document.getElementById('result3');
            const completeResponse = "ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì´ ì „ì²´ ë©”ì‹œì§€ê°€ ì™„ì „íˆ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤!";
            let finalDisplayedText = "";
            
            resultElement.textContent = "ì™„ë£Œ í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...";
            resultElement.className = "test-result";
            
            try {
                const finalText = await simulateStreaming(
                    completeResponse,
                    (text) => {
                        finalDisplayedText = text;
                        resultElement.textContent = `ìŠ¤íŠ¸ë¦¬ë° ì¤‘: "${text}"`;
                    },
                    'progress3'
                );
                
                // ê²€ì¦
                const completionOk = finalText === completeResponse && 
                                   finalDisplayedText === completeResponse &&
                                   finalText.length === completeResponse.length;
                
                resultElement.className = `test-result ${completionOk ? 'success' : 'error'}`;
                resultElement.textContent = `
í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${completionOk ? 'âœ… í†µê³¼' : 'âŒ ì‹¤íŒ¨'}
ìµœì¢… ë°˜í™˜ê°’: "${finalText}"
ìµœì¢… í‘œì‹œê°’: "${finalDisplayedText}"
ê¸¸ì´ ì¼ì¹˜: ${finalText.length === completeResponse.length ? 'âœ…' : 'âŒ'}
ë‚´ìš© ì¼ì¹˜: ${finalText === completeResponse ? 'âœ…' : 'âŒ'}
                `.trim();
            } catch (error) {
                resultElement.className = "test-result error";
                resultElement.textContent = `âŒ ì—ëŸ¬: ${error.message}`;
            }
        }

        // Test 4: íŠ¹ìˆ˜ ë¬¸ì ë° ë©€í‹°ë¼ì¸ ì‘ë‹µ
        async function testSpecialCharacters() {
            const resultElement = document.getElementById('result4');
            const specialResponse = "íŠ¹ìˆ˜ë¬¸ì í…ŒìŠ¤íŠ¸: ğŸ¤– Ã©mojis & spÃ«cial chars!\në‘ ë²ˆì§¸ ì¤„ì…ë‹ˆë‹¤.\nì„¸ ë²ˆì§¸ ì¤„: @#$%^&*()";
            let streamedText = "";
            
            resultElement.textContent = "íŠ¹ìˆ˜ ë¬¸ì í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...";
            resultElement.className = "test-result";
            
            try {
                const finalText = await simulateStreaming(
                    specialResponse,
                    (text) => {
                        streamedText = text;
                        resultElement.textContent = `í˜„ì¬: "${text}"`;
                    },
                    'progress4'
                );
                
                // ê²€ì¦
                const linesOk = finalText.split('\n').length === 3;
                const specialCharsOk = finalText.includes('ğŸ¤–') && finalText.includes('Ã©mojis') && finalText.includes('@#$%^&*()');
                const passed = finalText === specialResponse && streamedText === specialResponse && linesOk && specialCharsOk;
                
                resultElement.className = `test-result ${passed ? 'success' : 'error'}`;
                resultElement.textContent = `
í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${passed ? 'âœ… í†µê³¼' : 'âŒ ì‹¤íŒ¨'}
ì¤„ ìˆ˜: ${finalText.split('\n').length} (ì˜ˆìƒ: 3)
íŠ¹ìˆ˜ ë¬¸ì í¬í•¨: ${specialCharsOk ? 'âœ…' : 'âŒ'}
ìµœì¢… í…ìŠ¤íŠ¸:
"${finalText}"
                `.trim();
            } catch (error) {
                resultElement.className = "test-result error";
                resultElement.textContent = `âŒ ì—ëŸ¬: ${error.message}`;
            }
        }

        // Test 5: ì‘ë‹µ íŒŒì‹± í†µí•© í…ŒìŠ¤íŠ¸
        async function testResponseParsing() {
            const resultElement = document.getElementById('result5');
            
            resultElement.textContent = "ì‘ë‹µ íŒŒì‹± í†µí•© í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...";
            resultElement.className = "test-result";
            
            try {
                // ìˆ˜ì •ëœ íŒŒì‹± ë¡œì§ ì‹œë®¬ë ˆì´ì…˜
                const mockResponseData = {
                    ok: true,
                    response: "ìˆ˜ì •ëœ íŒŒì‹± ë¡œì§ì´ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•©ë‹ˆë‹¤!"
                };
                
                // ì˜¬ë°”ë¥¸ íŒŒì‹±: data.response ì‚¬ìš© (data.data?.response ì œê±°ë¨)
                const responseText = mockResponseData.response || "ì‘ë‹µì„ ë°›ì•˜ì§€ë§Œ ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.";
                
                let streamedContent = "";
                const finalText = await simulateStreaming(
                    responseText,
                    (text) => {
                        streamedContent = text;
                        resultElement.textContent = `íŒŒì‹±ëœ ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë°: "${text}"`;
                    },
                    'progress5'
                );
                
                // ë¹ˆ ì‘ë‹µ í…ŒìŠ¤íŠ¸ë„ ìˆ˜í–‰
                const emptyMockData = { ok: true, response: "" };
                const emptyResponseText = emptyMockData.response || "ì‘ë‹µì„ ë°›ì•˜ì§€ë§Œ ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.";
                
                // ê²€ì¦
                const parsingOk = finalText === mockResponseData.response;
                const fallbackOk = emptyResponseText === "ì‘ë‹µì„ ë°›ì•˜ì§€ë§Œ ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.";
                const passed = parsingOk && fallbackOk;
                
                resultElement.className = `test-result ${passed ? 'success' : 'error'}`;
                resultElement.textContent = `
í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${passed ? 'âœ… í†µê³¼' : 'âŒ ì‹¤íŒ¨'}
ì •ìƒ ì‘ë‹µ íŒŒì‹±: ${parsingOk ? 'âœ…' : 'âŒ'}
ë¹ˆ ì‘ë‹µ í´ë°±: ${fallbackOk ? 'âœ…' : 'âŒ'}
ìµœì¢… ìŠ¤íŠ¸ë¦¬ë° ê²°ê³¼: "${finalText}"
ë¹ˆ ì‘ë‹µ í´ë°± ë©”ì‹œì§€: "${emptyResponseText}"
                `.trim();
            } catch (error) {
                resultElement.className = "test-result error";
                resultElement.textContent = `âŒ ì—ëŸ¬: ${error.message}`;
            }
        }

        // ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runAllTests() {
            const overallResult = document.getElementById('overall-result');
            overallResult.textContent = "ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...";
            overallResult.className = "test-result";
            
            const tests = [
                { name: "ì§§ì€ ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë°", func: testShortResponse },
                { name: "ê¸´ ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë°", func: testLongResponse },
                { name: "ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ í™•ì¸", func: testStreamingCompletion },
                { name: "íŠ¹ìˆ˜ ë¬¸ì í…ŒìŠ¤íŠ¸", func: testSpecialCharacters },
                { name: "ì‘ë‹µ íŒŒì‹± í†µí•©", func: testResponseParsing }
            ];
            
            const results = [];
            
            for (const test of tests) {
                try {
                    await test.func();
                    results.push(`âœ… ${test.name}: í†µê³¼`);
                } catch (error) {
                    results.push(`âŒ ${test.name}: ì‹¤íŒ¨ (${error.message})`);
                }
                
                // í…ŒìŠ¤íŠ¸ ê°„ ì ì‹œ ëŒ€ê¸°
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            const passedCount = results.filter(r => r.includes('âœ…')).length;
            const totalCount = results.length;
            const allPassed = passedCount === totalCount;
            
            overallResult.className = `test-result ${allPassed ? 'success' : 'error'}`;
            overallResult.textContent = `
ì „ì²´ í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${allPassed ? 'âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼' : 'âŒ ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨'}
í†µê³¼: ${passedCount}/${totalCount}

ìƒì„¸ ê²°ê³¼:
${results.join('\n')}
            `.trim();
        }
    </script>
</body>
</html>